using ModelContextProtocol.Server;
using System.ComponentModel;
using System.Text.Json;
using System.Threading.Tasks;
using System.Threading;
using System;
using System.Collections.Generic;
using System.Linq;

namespace grasshoppermcp.Prompts
{
    /// <summary>
    /// Grasshopper MCP æç¤ºé›†
    /// </summary>
    [McpServerPromptType]
    public class GrasshopperPrompts
    {
        /// <summary>
        /// Grasshopper æ“ä½œæŒ‡å—æç¤º
        /// </summary>
        [McpServerPrompt(Name = "grasshopper_workflow_guide")]
        [Description("æä¾› Grasshopper æ“ä½œçš„å®Œæ•´å·¥ä½œæµæŒ‡å—")]
        public static Task<string> GetWorkflowGuide(
            [Description("ç”¨æˆ·çš„è®¾è®¡æ„å›¾æˆ–ç›®æ ‡")] string design_intent = "",
            CancellationToken cancellationToken = default)
        {
            var systemMessage = $@"# Grasshopper MCP æ“ä½œæŒ‡å—

## æ ¸å¿ƒåŸåˆ™
åœ¨ Grasshopper ä¸­åˆ›å»ºä»»ä½•è®¾è®¡ä¹‹å‰ï¼Œä½ å¿…é¡»éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

### 1. äº†è§£å½“å‰çŠ¶æ€
- **å§‹ç»ˆ**å…ˆè°ƒç”¨ `grasshopper://current_document` èµ„æºæ¥æŸ¥çœ‹å½“å‰ç”»å¸ƒä¸Šçš„ç»„ä»¶
- æ£€æŸ¥å·²æœ‰çš„ç»„ä»¶ã€å®ƒä»¬çš„ä½ç½®ã€å‚æ•°å’Œè¿æ¥å…³ç³»
- ç†è§£ç°æœ‰çš„è®¾è®¡æµç¨‹

### 2. ç²¾ç¡®çš„å·¥å…·ä½¿ç”¨
- **ç»„ä»¶å‘½å**ï¼šä½¿ç”¨å‡†ç¡®çš„ç»„ä»¶ç±»å‹åç§°ï¼Œå‚è€ƒ `grasshopper://component_library` èµ„æº
- **ä½ç½®è§„åˆ’**ï¼šåˆç†è§„åˆ’ç»„ä»¶åœ¨ç”»å¸ƒä¸Šçš„ä½ç½®ï¼Œé¿å…é‡å 
- **è¿æ¥éªŒè¯**ï¼šè¿æ¥ç»„ä»¶å‰ï¼Œç¡®è®¤æºç»„ä»¶å’Œç›®æ ‡ç»„ä»¶çš„å‚æ•°åç§°

### 3. å¸¸è§ç»„ä»¶ç±»å‹
- **è¾“å…¥å‚æ•°**ï¼š`slider`ï¼ˆæ•°å€¼æ»‘å—ï¼‰ã€`panel`ï¼ˆæ–‡æœ¬é¢æ¿ï¼‰ã€`point`ï¼ˆç‚¹ï¼‰
- **å‡ ä½•ä½“**ï¼š`circle`ï¼ˆåœ†ï¼‰ã€`line`ï¼ˆç›´çº¿ï¼‰ã€`curve`ï¼ˆæ›²çº¿ï¼‰
- **å˜æ¢**ï¼š`move`ï¼ˆç§»åŠ¨ï¼‰ã€`rotate`ï¼ˆæ—‹è½¬ï¼‰ã€`scale`ï¼ˆç¼©æ”¾ï¼‰
- **æ¨¡å¼**ï¼š`voronoi`ï¼ˆæ³°æ£®å¤šè¾¹å½¢ï¼‰ã€`delaunay`ï¼ˆå¾·åŠ³å†…ä¸‰è§’å‰–åˆ†ï¼‰

### 4. å·¥ä½œæµç¨‹
1. æ£€æŸ¥å½“å‰æ–‡æ¡£çŠ¶æ€
2. è§„åˆ’ç»„ä»¶å¸ƒå±€
3. é€æ­¥æ·»åŠ ç»„ä»¶
4. **è®¾ç½®å‚æ•°å€¼**
5. **å»ºç«‹è¿æ¥**
6. éªŒè¯ç»“æœ

### 5. è¿æ¥è§„åˆ™
- æ»‘å—é€šå¸¸è¿æ¥åˆ°éœ€è¦æ•°å€¼è¾“å…¥çš„ç»„ä»¶
- å‡ ä½•ä½“ç»„ä»¶çš„è¾“å‡ºè¿æ¥åˆ°å˜æ¢æˆ–å…¶ä»–å‡ ä½•æ“ä½œ
- é¢æ¿ç”¨äºæ˜¾ç¤ºç»“æœæˆ–è¾“å…¥æ–‡æœ¬

## è®¾è®¡æ„å›¾
ç”¨æˆ·çš„è®¾è®¡æ„å›¾ï¼š{design_intent}

è¯·æ ¹æ®è¿™ä¸ªæ„å›¾ï¼Œåˆ¶å®šåˆé€‚çš„å®ç°ç­–ç•¥ã€‚

# é‡ç‚¹
### é‡è¦æç¤ºï¼š
- å¯¹äºéœ€è¦å¹³é¢è¾“å…¥çš„ç»„ä»¶ï¼ˆå¦‚ Boxã€Circleã€Rectangle ç­‰ï¼‰ï¼Œå§‹ç»ˆä½¿ç”¨ â€œxy planeâ€ ä½œä¸ºå¹³é¢æ¥æºï¼Œè€Œä¸æ˜¯ Point ç»„ä»¶
- ä½¿ç”¨æ ‡å‡†åŒ–çš„ç»„ä»¶åç§°ï¼Œå¦‚ xy plane, box, circle, number slider ç­‰
- åæ ‡å€¼åº”è¯¥æ˜¯æ•°å­—ï¼Œå»ºè®®ä½¿ç”¨ç½‘æ ¼å¸ƒå±€ï¼ˆxå’Œyçš„é—´éš”çº¦ä¸º200-300å•ä½ï¼‰
- ç¡®ä¿å…ˆåˆ›å»ºæ‰€æœ‰å…ƒä»¶ï¼Œç„¶åå†è¿›è¡Œè¿æ¥
- å¯¹äºå¹³é¢åˆ°å‡ ä½•å…ƒä»¶çš„è¿æ¥ï¼Œæºå‚æ•°åº”ä¸º â€œPlaneâ€ï¼Œç›®æ ‡å‚æ•°åº”ä¸º â€œBaseâ€ æˆ– â€œPlaneâ€

";

            return Task.FromResult(systemMessage);
        }

        /// <summary>
        /// ç»„ä»¶è¿æ¥æŒ‡å—
        /// </summary>
        [McpServerPrompt(Name = "component_connection_guide")]
        [Description("æä¾›ç»„ä»¶è¿æ¥çš„è¯¦ç»†æŒ‡å—")]
        public static Task<string> GetConnectionGuide(
            [Description("æºç»„ä»¶ç±»å‹")] string source_component = "",
            [Description("ç›®æ ‡ç»„ä»¶ç±»å‹")] string target_component = "",
            CancellationToken cancellationToken = default)
        {
            var systemMessage = $@"# ç»„ä»¶è¿æ¥æŒ‡å—

## è¿æ¥å‰çš„å‡†å¤‡å·¥ä½œ
1. **è¯»å–å½“å‰æ–‡æ¡£**ï¼šä½¿ç”¨ `grasshopper://current_document` èµ„æº
2. **ç¡®è®¤ç»„ä»¶å­˜åœ¨**ï¼šæ£€æŸ¥æºç»„ä»¶å’Œç›®æ ‡ç»„ä»¶æ˜¯å¦å·²åˆ›å»º
3. **äº†è§£å‚æ•°åç§°**ï¼šç¡®è®¤å‡†ç¡®çš„è¾“å…¥/è¾“å‡ºå‚æ•°åç§°

## å¸¸è§è¿æ¥æ¨¡å¼

### æ•°å€¼æ»‘å—è¿æ¥
- æ»‘å—è¾“å‡ºï¼šé€šå¸¸æ˜¯ `Value` æˆ– `N`
- å¸¸è§ç›®æ ‡ï¼š`Radius`ï¼ˆåŠå¾„ï¼‰ã€`Height`ï¼ˆé«˜åº¦ï¼‰ã€`Count`ï¼ˆæ•°é‡ï¼‰

### å‡ ä½•ä½“è¿æ¥
- ç‚¹ â†’ åœ†å¿ƒï¼š`Point` â†’ `Center`
- çº¿ â†’ æ›²çº¿ï¼š`Line` â†’ `Curve`
- åœ† â†’ å‡ ä½•ä½“ï¼š`Circle` â†’ `Geometry`

### å˜æ¢è¿æ¥
- å‡ ä½•ä½“ â†’ å˜æ¢å¯¹è±¡ï¼š`Geometry` â†’ `Geometry`
- å‘é‡ â†’ ç§»åŠ¨æ–¹å‘ï¼š`Vector` â†’ `Motion`

## è¿æ¥æ­¥éª¤
1. ç¡®è®¤æºç»„ä»¶IDå’Œè¾“å‡ºå‚æ•°åç§°
2. ç¡®è®¤ç›®æ ‡ç»„ä»¶IDå’Œè¾“å…¥å‚æ•°åç§°
3. ä½¿ç”¨ `connect_components` å·¥å…·å»ºç«‹è¿æ¥
4. éªŒè¯è¿æ¥æ˜¯å¦æˆåŠŸ

## å½“å‰è¿æ¥ä»»åŠ¡
æºç»„ä»¶ï¼š{source_component}
ç›®æ ‡ç»„ä»¶ï¼š{target_component}

è¯·æ ¹æ®è¿™äº›ç»„ä»¶ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„è¿æ¥ç­–ç•¥ã€‚";

            return Task.FromResult(systemMessage);
        }

        /// <summary>
        /// é”™è¯¯æ’æŸ¥æŒ‡å—
        /// </summary>
        [McpServerPrompt(Name = "error_troubleshooting")]
        [Description("æä¾›é”™è¯¯æ’æŸ¥çš„è¯¦ç»†æŒ‡å—")]
        public static Task<string> GetTroubleshootingGuide(
            [Description("é‡åˆ°çš„é”™è¯¯ä¿¡æ¯")] string error_message = "",
            CancellationToken cancellationToken = default)
        {
            var systemMessage = $@"# é”™è¯¯æ’æŸ¥æŒ‡å—

## å¸¸è§é”™è¯¯ç±»å‹åŠè§£å†³æ–¹æ¡ˆ

### 1. ç»„ä»¶åˆ›å»ºå¤±è´¥
- **é”™è¯¯ç‰¹å¾**ï¼š`add_component` è¿”å›é”™è¯¯
- **æ’æŸ¥æ­¥éª¤**ï¼š
  1. æ£€æŸ¥ Grasshopper æ˜¯å¦æ­£å¸¸è¿è¡Œ
  2. ç¡®è®¤ç»„ä»¶ç±»å‹åç§°æ­£ç¡®
  3. éªŒè¯åæ ‡å‚æ•°æœ‰æ•ˆ

### 2. è¿æ¥å¤±è´¥
- **é”™è¯¯ç‰¹å¾**ï¼š`connect_components` è¿”å›é”™è¯¯
- **æ’æŸ¥æ­¥éª¤**ï¼š
  1. ç¡®è®¤æºç»„ä»¶å’Œç›®æ ‡ç»„ä»¶å­˜åœ¨
  2. æ£€æŸ¥å‚æ•°åç§°æ˜¯å¦æ­£ç¡®
  3. éªŒè¯å‚æ•°ç±»å‹æ˜¯å¦å…¼å®¹

### 3. å‚æ•°ä¸åŒ¹é…
- **é”™è¯¯ç‰¹å¾**ï¼šè¿æ¥å»ºç«‹ä½†æ²¡æœ‰æ•°æ®æµ
- **æ’æŸ¥æ­¥éª¤**ï¼š
  1. æ£€æŸ¥è¾“å‡ºå‚æ•°ç±»å‹
  2. ç¡®è®¤è¾“å…¥å‚æ•°æœŸæœ›çš„æ•°æ®ç±»å‹
  3. å¯èƒ½éœ€è¦ç±»å‹è½¬æ¢ç»„ä»¶

### 4. ç»„ä»¶æœªæ˜¾ç¤º
- **é”™è¯¯ç‰¹å¾**ï¼šç»„ä»¶åˆ›å»ºæˆåŠŸä½†çœ‹ä¸åˆ°
- **æ’æŸ¥æ­¥éª¤**ï¼š
  1. æ£€æŸ¥ç»„ä»¶ä½ç½®æ˜¯å¦åœ¨å¯è§åŒºåŸŸ
  2. åˆ·æ–°ç”»å¸ƒè§†å›¾
  3. è°ƒæ•´ç”»å¸ƒç¼©æ”¾çº§åˆ«

## è¯Šæ–­å·¥å…·
1. **å½“å‰æ–‡æ¡£çŠ¶æ€**ï¼š`grasshopper://current_document`
2. **ç¯å¢ƒä¿¡æ¯**ï¼š`grasshopper://environment`
3. **ç»„ä»¶åº“**ï¼š`grasshopper://component_library`

## å½“å‰é”™è¯¯
é”™è¯¯ä¿¡æ¯ï¼š{error_message}

è¯·æ ¹æ®è¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œæä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚";

            return Task.FromResult(systemMessage);
        }

        /// <summary>
        /// è®¾è®¡æ¨¡å¼æŒ‡å—
        /// </summary>
        [McpServerPrompt(Name = "design_pattern_guide")]
        [Description("æä¾›å¸¸è§è®¾è®¡æ¨¡å¼çš„å®ç°æŒ‡å—")]
        public static Task<string> GetDesignPatternGuide(
            [Description("è®¾è®¡æ¨¡å¼ç±»å‹ï¼Œå¦‚ voronoiã€gridã€spiral ç­‰")] string pattern_type = "",
            CancellationToken cancellationToken = default)
        {
            var systemMessage = $@"# è®¾è®¡æ¨¡å¼å®ç°æŒ‡å—

## æ¨¡å¼ç±»å‹ï¼š{pattern_type}

### å®ç°æ­¥éª¤æ¨¡æ¿

#### 1. å‡†å¤‡é˜¶æ®µ
- è¯»å–å½“å‰æ–‡æ¡£çŠ¶æ€
- è§„åˆ’ç»„ä»¶å¸ƒå±€
- ç¡®å®šæ‰€éœ€å‚æ•°

#### 2. åˆ›å»ºè¾“å…¥å‚æ•°
- æ•°å€¼æ»‘å—ï¼šæ§åˆ¶å¤§å°ã€æ•°é‡ã€é—´è·ç­‰
- ç‚¹å‚æ•°ï¼šå®šä¹‰èµ·å§‹ä½ç½®æˆ–å…³é”®ç‚¹
- æ–‡æœ¬é¢æ¿ï¼šæ˜¾ç¤ºä¿¡æ¯æˆ–è¾“å…¥æ–‡æœ¬

#### 3. ç”ŸæˆåŸºç¡€å‡ ä½•
- åˆ›å»ºåŸºæœ¬å½¢çŠ¶ï¼ˆç‚¹ã€çº¿ã€åœ†ç­‰ï¼‰
- åº”ç”¨å˜æ¢ï¼ˆç§»åŠ¨ã€æ—‹è½¬ã€ç¼©æ”¾ï¼‰
- å»ºç«‹å‡ ä½•å…³ç³»

#### 4. åº”ç”¨æ¨¡å¼ç®—æ³•
- ä½¿ç”¨ç‰¹å®šçš„æ¨¡å¼ç»„ä»¶
- è¿æ¥è¾“å…¥å‚æ•°
- è°ƒæ•´å‚æ•°å€¼

#### 5. åå¤„ç†
- å‡ ä½•ä½“ä¼˜åŒ–
- è§†è§‰æ•ˆæœè°ƒæ•´
- è¾“å‡ºè®¾ç½®

## å¸¸è§æ¨¡å¼å®ç°

### Voronoi æ¨¡å¼
1. åˆ›å»ºç‚¹é›†åˆ
2. å®šä¹‰è¾¹ç•Œ
3. åº”ç”¨ Voronoi ç»„ä»¶
4. è°ƒæ•´å•å…ƒæ ¼å¤§å°

### ç½‘æ ¼æ¨¡å¼
1. å®šä¹‰ç½‘æ ¼é—´è·
2. åˆ›å»ºç‚¹é˜µåˆ—
3. è¿æ¥ç›¸é‚»ç‚¹
4. åº”ç”¨å˜æ¢

### èºæ—‹æ¨¡å¼
1. è®¾ç½®èºæ—‹å‚æ•°
2. åˆ›å»ºèºæ—‹æ›²çº¿
3. æ²¿æ›²çº¿åˆ†å¸ƒå¯¹è±¡
4. è°ƒæ•´å¯†åº¦å’Œæ–¹å‘

è¯·æ ¹æ®é€‰æ‹©çš„æ¨¡å¼ç±»å‹ï¼Œåˆ¶å®šå…·ä½“çš„å®ç°è®¡åˆ’ã€‚";

            return Task.FromResult(systemMessage);
        }

        /// <summary>
        /// å·¥å…·é€‰æ‹©æŒ‡å—
        /// </summary>
        [McpServerPrompt(Name = "tool_selection_guide")]
        [Description("æä¾›è¯¦ç»†çš„å·¥å…·é€‰æ‹©æŒ‡å—å’Œæœ€ä½³å®è·µï¼Œå¸®åŠ© AI é€‰æ‹©åˆé€‚çš„å·¥å…·")]
        public static Task<string> GetToolSelectionGuide(
            [Description("ç”¨æˆ·çš„å…·ä½“éœ€æ±‚æˆ–æ„å›¾")] string user_intent = "",
            [Description("å½“å‰çš„å¤æ‚åº¦çº§åˆ«ï¼šsimpleã€intermediateã€complex")] string complexity_level = "simple",
            CancellationToken cancellationToken = default)
        {
            var systemMessage = $@"# ğŸ¯ Grasshopper MCP å·¥å…·é€‰æ‹©æŒ‡å—

## ç”¨æˆ·éœ€æ±‚ï¼š{user_intent}
## å¤æ‚åº¦çº§åˆ«ï¼š{complexity_level}

---

## ğŸ“‹ æ¨èçš„å·¥å…·é€‰æ‹©æµç¨‹

### 1. åŸºç¡€ä¿¡æ¯æ”¶é›†
- **å§‹ç»ˆå…ˆè°ƒç”¨**: `get_document_info` - äº†è§£å½“å‰ç”»å¸ƒçŠ¶æ€
- **æ£€æŸ¥ç°æœ‰ç»„ä»¶**: é¿å…é‡å¤åˆ›å»ºï¼Œäº†è§£å·²æœ‰è¿æ¥

### 2. å·¥å…·é€‰æ‹©ç­–ç•¥

#### âœ… ç®€å•éœ€æ±‚ï¼ˆæ¨èä¼˜å…ˆä½¿ç”¨ï¼‰
**é€‚ç”¨åœºæ™¯**: å•ä¸ªç»„ä»¶ã€åŸºæœ¬å‡ ä½•ã€ç®€å•å‚æ•°æ§åˆ¶
- `add_component` - æ·»åŠ å•ä¸ªç»„ä»¶ï¼ˆæ»‘å—ã€é¢æ¿ã€ç‚¹ã€åœ†ã€çº¿ç­‰ï¼‰
- `connect_components` - è¿æ¥ä¸¤ä¸ªç»„ä»¶
- `get_document_info` - æŸ¥çœ‹ç”»å¸ƒçŠ¶æ€

**ç¤ºä¾‹**:
```
éœ€æ±‚: åˆ›å»ºä¸€ä¸ªæ»‘å—æ§åˆ¶åœ†çš„åŠå¾„
æ–¹æ¡ˆ: add_component('slider') â†’ add_component('circle') â†’ connect_components()
```

#### âš ï¸ ä¸­ç­‰å¤æ‚åº¦ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
**é€‚ç”¨åœºæ™¯**: å¤šä¸ªç›¸å…³ç»„ä»¶ã€éœ€è¦ç‰¹å®šç»„åˆ
- å¤šæ¬¡ä½¿ç”¨ `add_component` + `connect_components`
- å¦‚æœæœ‰é¢„å®šä¹‰æ¨¡å¼ï¼Œå…ˆæŸ¥è¯¢å†ä½¿ç”¨

#### ğŸ” å¤æ‚éœ€æ±‚ï¼ˆå¿…é¡»å…ˆæŸ¥è¯¢ï¼‰
**é€‚ç”¨åœºæ™¯**: å¤æ‚å‡ ä½•æ¨¡å¼ã€ä¸“é—¨çš„ç®—æ³•æ¨¡å¼
- **å¿…é¡»å…ˆè°ƒç”¨**: `get_available_patterns` - æŸ¥çœ‹å¯ç”¨çš„é¢„å®šä¹‰æ¨¡å¼
- **ç„¶åè°ƒç”¨**: `create_pattern` - åˆ›å»ºåŒ¹é…çš„æ¨¡å¼

**é‡è¦**: ç»å¯¹ä¸è¦ç›´æ¥ä½¿ç”¨ `create_pattern` è€Œä¸å…ˆæŸ¥è¯¢å¯ç”¨æ¨¡å¼ï¼

---

## ğŸš« å¸¸è§é”™è¯¯åŠé¿å…æ–¹æ³•

### é”™è¯¯1: ç›´æ¥ä½¿ç”¨ create_pattern
```
âŒ é”™è¯¯: create_pattern('voronoi cube')  // ä¸çŸ¥é“æ˜¯å¦å­˜åœ¨
âœ… æ­£ç¡®: get_available_patterns() â†’ ç¡®è®¤æ¨¡å¼åç§° â†’ create_pattern('ç¡®åˆ‡åç§°')
```

### é”™è¯¯2: è¿‡åº¦ä½¿ç”¨å¤æ‚å·¥å…·
```
âŒ é”™è¯¯: ä¸ºç®€å•çš„åœ†ä½¿ç”¨ create_pattern
âœ… æ­£ç¡®: ç®€å•éœ€æ±‚ç”¨ add_component('circle')
```

### é”™è¯¯3: è·³è¿‡çŠ¶æ€æ£€æŸ¥
```
âŒ é”™è¯¯: ç›´æ¥å¼€å§‹åˆ›å»ºç»„ä»¶
âœ… æ­£ç¡®: å…ˆ get_document_info äº†è§£ç°çŠ¶
```

---

## ğŸ¨ å…·ä½“åœºæ™¯å†³ç­–æ ‘

### åœºæ™¯1: åˆ›å»ºåŸºç¡€å‡ ä½•
```
éœ€æ±‚: ç‚¹ã€çº¿ã€åœ†ã€é¢æ¿ã€æ»‘å—
â†’ ä½¿ç”¨: add_component
â†’ ç†ç”±: åŸºç¡€ç»„ä»¶ï¼Œç®€å•å¯é 
```

### åœºæ™¯2: å‚æ•°åŒ–è®¾è®¡
```
éœ€æ±‚: æ»‘å—æ§åˆ¶å‡ ä½•å‚æ•°
â†’ ä½¿ç”¨: add_component('slider') + add_component('geometry') + connect_components
â†’ ç†ç”±: æ¸…æ™°çš„ç»„ä»¶ç»„åˆ
```

### åœºæ™¯3: å¤æ‚å‡ ä½•ç®—æ³•
```
éœ€æ±‚: æ³°æ£®å¤šè¾¹å½¢ã€å¾·åŠ³å†…ä¸‰è§’ç­‰
â†’ ä½¿ç”¨: get_available_patterns â†’ create_pattern
â†’ ç†ç”±: éœ€è¦ä¸“é—¨çš„ç®—æ³•ï¼Œå¿…é¡»å…ˆç¡®è®¤å¯ç”¨æ€§
```

---

## ğŸ’¡ æœ€ä½³å®è·µåŸåˆ™

1. **ç®€å•ä¼˜å…ˆ**: èƒ½ç”¨åŸºç¡€å·¥å…·è§£å†³çš„ï¼Œä¸ç”¨å¤æ‚å·¥å…·
2. **æŸ¥è¯¢å…ˆè¡Œ**: å¤æ‚æ¨¡å¼å¿…é¡»å…ˆæŸ¥è¯¢å¯ç”¨æ€§
3. **çŠ¶æ€æ„ŸçŸ¥**: æ¯æ¬¡æ“ä½œå‰äº†è§£å½“å‰çŠ¶æ€
4. **é€æ­¥æ„å»º**: ä¸€æ­¥ä¸€æ­¥æ·»åŠ ç»„ä»¶ï¼Œå†å»ºç«‹è¿æ¥
5. **éªŒè¯ç»“æœ**: å…³é”®æ­¥éª¤åæ£€æŸ¥ç»“æœ

---

## ğŸ”§ å·¥å…·åŠŸèƒ½å¯¹æ¯”

| å·¥å…· | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ | å¯é æ€§ | æ¨èåº¦ |
|------|----------|--------|--------|--------|
| add_component | åŸºç¡€ç»„ä»¶ | ä½ | é«˜ | â­â­â­â­â­ |
| connect_components | ç»„ä»¶è¿æ¥ | ä½ | é«˜ | â­â­â­â­â­ |
| get_document_info | çŠ¶æ€æŸ¥è¯¢ | ä½ | é«˜ | â­â­â­â­â­ |
| get_available_patterns | æ¨¡å¼æŸ¥è¯¢ | ä¸­ | é«˜ | â­â­â­â­ |
| create_pattern | å¤æ‚æ¨¡å¼ | é«˜ | ä¸­ | â­â­â­ |

---

## ğŸ“Œ è®°ä½è¿™äº›å…³é”®ç‚¹

1. **ä¸ç¡®å®šæ—¶ï¼Œé€‰æ‹©ç®€å•çš„å·¥å…·**
2. **create_pattern å‰å¿…é¡»å…ˆ get_available_patterns**
3. **æ¯ä¸ªå¤æ‚æ“ä½œå‰éƒ½è¦ get_document_info**
4. **ç»„ä»¶åæ ‡å»ºè®®é—´éš” 100-200 åƒç´ **
5. **è¿æ¥ç»„ä»¶æ—¶ç¡®è®¤å‚æ•°åç§°çš„å‡†ç¡®æ€§**

åŸºäºç”¨æˆ·éœ€æ±‚ '{user_intent}' å’Œå¤æ‚åº¦ '{complexity_level}'ï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ç›¸åº”çº§åˆ«çš„å·¥å…·é€‰æ‹©ã€‚
";

            return Task.FromResult(systemMessage);
        }
    }
}
